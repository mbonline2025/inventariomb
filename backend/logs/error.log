{"level":"error","message":"Erro não tratado: Not allowed by CORS: http://localhost:5173","service":"mb-inventario","stack":"Error: Not allowed by CORS: http://localhost:5173\n    at origin (/Users/ricardoreis/Downloads/sistemainventario/backend/src/index.ts:49:21)\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/cors/lib/index.js:219:13\n    at optionsCallback (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/cors/lib/index.js:199:9)\n    at corsMiddleware (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/cors/lib/index.js:204:7)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:328:13)\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:280:10)\n    at internalNext (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/helmet/index.cjs:531:6)","status":500,"timestamp":"2025-08-12T15:45:50.319Z"}
{"clientVersion":"5.22.0","code":"P2003","level":"error","message":"Erro ao criar log de auditoria: \nInvalid `prisma.auditLog.create()` invocation in\n/Users/ricardoreis/Downloads/sistemainventario/backend/src/middleware/audit.ts:16:25\n\n  13 const action = `${req.method} ${req.route?.path || req.path}`;\n  14 const entityId = req.params.id || 'unknown';\n  15 \n→ 16 prisma.auditLog.create(\nForeign key constraint violated: `entityId`","meta":{"field_name":"entityId","modelName":"AuditLog"},"name":"PrismaClientKnownRequestError","service":"mb-inventario","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.auditLog.create()` invocation in\n/Users/ricardoreis/Downloads/sistemainventario/backend/src/middleware/audit.ts:16:25\n\n  13 const action = `${req.method} ${req.route?.path || req.path}`;\n  14 const entityId = req.params.id || 'unknown';\n  15 \n→ 16 prisma.auditLog.create(\nForeign key constraint violated: `entityId`\n    at $n.handleRequestError (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:130:9633)","timestamp":"2025-08-12T15:48:46.128Z"}
{"expiredAt":"2025-08-12T16:02:24.000Z","level":"error","message":"Erro na autenticação: jwt expired","name":"TokenExpiredError","service":"mb-inventario","stack":"TokenExpiredError: jwt expired\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:190:21\n    at getSecret (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at Object.module.exports [as verify] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at verifyToken (/Users/ricardoreis/Downloads/sistemainventario/backend/src/utils/auth.ts:23:14)\n    at authenticate (/Users/ricardoreis/Downloads/sistemainventario/backend/src/middleware/auth.ts:15:32)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-12T16:02:45.799Z"}
{"expiredAt":"2025-08-12T16:02:24.000Z","level":"error","message":"Erro na autenticação: jwt expired","name":"TokenExpiredError","service":"mb-inventario","stack":"TokenExpiredError: jwt expired\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:190:21\n    at getSecret (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at Object.module.exports [as verify] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at verifyToken (/Users/ricardoreis/Downloads/sistemainventario/backend/src/utils/auth.ts:23:14)\n    at authenticate (/Users/ricardoreis/Downloads/sistemainventario/backend/src/middleware/auth.ts:15:32)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-12T16:02:45.811Z"}
{"expiredAt":"2025-08-12T16:17:46.000Z","level":"error","message":"Erro na autenticação: jwt expired","name":"TokenExpiredError","service":"mb-inventario","stack":"TokenExpiredError: jwt expired\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:190:21\n    at getSecret (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at Object.module.exports [as verify] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at verifyToken (/Users/ricardoreis/Downloads/sistemainventario/backend/src/utils/auth.ts:23:14)\n    at authenticate (/Users/ricardoreis/Downloads/sistemainventario/backend/src/middleware/auth.ts:15:32)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-12T17:03:27.695Z"}
{"expiredAt":"2025-08-12T16:17:46.000Z","level":"error","message":"Erro na autenticação: jwt expired","name":"TokenExpiredError","service":"mb-inventario","stack":"TokenExpiredError: jwt expired\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:190:21\n    at getSecret (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:97:14)\n    at Object.module.exports [as verify] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/jsonwebtoken/verify.js:101:10)\n    at verifyToken (/Users/ricardoreis/Downloads/sistemainventario/backend/src/utils/auth.ts:23:14)\n    at authenticate (/Users/ricardoreis/Downloads/sistemainventario/backend/src/middleware/auth.ts:15:32)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-12T17:03:27.708Z"}
{"clientVersion":"5.22.0","code":"P2024","level":"error","message":"Erro no refresh: \nInvalid `prisma.user.findUnique()` invocation in\n/Users/ricardoreis/Downloads/sistemainventario/backend/src/controllers/auth.ts:127:38\n\n  124 const decoded = verifyRefreshToken(refreshToken);\n  125 \n  126 // Buscar usuário atualizado\n→ 127 const user = await prisma.user.findUnique(\nTimed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 13)","meta":{"connection_limit":13,"modelName":"User","timeout":10},"name":"PrismaClientKnownRequestError","service":"mb-inventario","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.user.findUnique()` invocation in\n/Users/ricardoreis/Downloads/sistemainventario/backend/src/controllers/auth.ts:127:38\n\n  124 const decoded = verifyRefreshToken(refreshToken);\n  125 \n  126 // Buscar usuário atualizado\n→ 127 const user = await prisma.user.findUnique(\nTimed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 13)\n    at $n.handleRequestError (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:130:9633)","timestamp":"2025-08-12T17:03:37.769Z"}
{"clientVersion":"5.22.0","code":"P2024","level":"error","message":"Erro no refresh: \nInvalid `prisma.user.findUnique()` invocation in\n/Users/ricardoreis/Downloads/sistemainventario/backend/src/controllers/auth.ts:127:38\n\n  124 const decoded = verifyRefreshToken(refreshToken);\n  125 \n  126 // Buscar usuário atualizado\n→ 127 const user = await prisma.user.findUnique(\nTimed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 13)","meta":{"connection_limit":13,"modelName":"User","timeout":10},"name":"PrismaClientKnownRequestError","service":"mb-inventario","stack":"PrismaClientKnownRequestError: \nInvalid `prisma.user.findUnique()` invocation in\n/Users/ricardoreis/Downloads/sistemainventario/backend/src/controllers/auth.ts:127:38\n\n  124 const decoded = verifyRefreshToken(refreshToken);\n  125 \n  126 // Buscar usuário atualizado\n→ 127 const user = await prisma.user.findUnique(\nTimed out fetching a new connection from the connection pool. More info: http://pris.ly/d/connection-pool (Current connection pool timeout: 10, connection limit: 13)\n    at $n.handleRequestError (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:7315)\n    at $n.handleAndLogRequestError (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:6623)\n    at $n.request (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:121:6307)\n    at async l (/Users/ricardoreis/Downloads/sistemainventario/backend/node_modules/@prisma/client/runtime/library.js:130:9633)","timestamp":"2025-08-12T17:03:37.778Z"}
